node{
    stage('Preparation') 
   { 
      git 'https://github.com/ranjithanagaraj/Project-1.git'
   }
      stage('Build')
   {
         sh 'mvn clean install -Dv=${BUILD_NUMBER}'
   }
      stage('SonarQube analysis') 
    { 
         sh 'mvn sonar:sonar -Dsonar.host.url=http://tmwhd68639dns1.eastus2.cloudapp.azure.com' 
     }
     stage('Artifactory upload')
     	{
		
			def server = Artifactory.server 'artifactory'
			def uploadSpec = """{
				
			"files":[
			{
			"pattern":"/var/lib/jenkins/workspace/pipeline1/target/*.jar",

			"target":"art1"
			}
			]
			}"""
			server.upload(uploadSpec)

    }
    		stage('downloading artifact')
				     	{
		
			def server = Artifactory.server 'artifactory'
			def downloadSpec = """{
				
			"files":[
			{
			"pattern":"art1/*.jar",

			"target":"/var/lib/jenkins/workspace/pipeline1/"
			}
			]
			}"""
			server.download(downloadSpec)

    }
    stage('docker image build')
    {
    sh 'docker-compose up'
    }

}
